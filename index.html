<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bolt.new Clone | AI Website Builder</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        background: '#09090b',
                        surface: '#18181b',
                        border: '#27272a',
                        primary: '#3b82f6',
                        primaryHover: '#2563eb',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #52525b; }

        /* Glassmorphism Utilities */
        .glass {
            background: rgba(24, 24, 27, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        /* Syntax Highlight Mock */
        .code-editor {
            font-family: 'JetBrains Mono', monospace;
            background-color: #0d0d0d;
            color: #a9b7c6;
            line-height: 1.5;
        }

        /* Loader Animation */
        .typing-dot {
            animation: typing 1.4s infinite ease-in-out both;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* Iframe Device Mockup */
        .browser-mockup {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        body { overflow: hidden; }
    </style>
</head>
<body class="bg-background text-zinc-300 h-screen w-screen flex overflow-hidden selection:bg-primary/30">

    <div id="mobileOverlay" class="fixed inset-0 bg-black/80 z-40 hidden lg:hidden backdrop-blur-sm" onclick="toggleSidebar()"></div>

    <aside id="sidebar" class="fixed lg:relative z-50 w-72 h-full flex flex-col glass border-r-0 lg:border-r border-white/5 transition-transform duration-300 -translate-x-full lg:translate-x-0">
        <div class="p-4 border-b border-white/5 flex items-center justify-between">
            <div class="flex items-center gap-2 font-bold text-white tracking-tight">
                <div class="w-8 h-8 rounded bg-primary flex items-center justify-center">
                    <i data-lucide="zap" class="text-white w-5 h-5"></i>
                </div>
                <span>Bolt.clone</span>
            </div>
            <button onclick="toggleSidebar()" class="lg:hidden text-zinc-400 hover:text-white">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </div>

        <div class="p-4">
            <button onclick="createNewProject()" class="w-full flex items-center justify-center gap-2 bg-white/5 hover:bg-white/10 text-white py-2.5 px-4 rounded-lg transition-all border border-white/5 font-medium text-sm">
                <i data-lucide="plus" class="w-4 h-4"></i>
                New Project
            </button>
        </div>

        <div class="flex-1 overflow-y-auto px-2 space-y-1" id="projectList">
            </div>

        <div class="p-4 border-t border-white/5 bg-black/20">
            <div class="space-y-3">
                <label class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Settings</label>
                <div class="relative">
                    <i data-lucide="key" class="absolute left-3 top-2.5 w-4 h-4 text-zinc-500"></i>
                    <input type="password" id="apiKeyInput" placeholder="OpenRouter/OpenAI Key" 
                        class="w-full bg-black/40 border border-white/10 rounded px-9 py-2 text-xs text-white focus:outline-none focus:border-primary placeholder-zinc-600 transition-colors">
                </div>
                <div class="relative">
                    <i data-lucide="cpu" class="absolute left-3 top-2.5 w-4 h-4 text-zinc-500"></i>
                    <select id="modelSelect" class="w-full bg-black/40 border border-white/10 rounded px-9 py-2 text-xs text-white focus:outline-none focus:border-primary appearance-none cursor-pointer">
                        <option value="google/gemini-2.0-flash-lite-preview-02-05:free">Gemini 2.0 Flash Lite (Free)</option>
                        <option value="deepseek/deepseek-r1:free">DeepSeek R1 (Free)</option>
                        <option value="anthropic/claude-3.5-sonnet">Claude 3.5 Sonnet</option>
                        <option value="openai/gpt-4o">GPT-4o</option>
                    </select>
                </div>
            </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col relative min-w-0">
        
        <header class="h-16 border-b border-white/5 flex items-center justify-between px-4 lg:px-6 bg-background/50 backdrop-blur-md z-10">
            <div class="flex items-center gap-3">
                <button onclick="toggleSidebar()" class="lg:hidden text-zinc-400 hover:text-white">
                    <i data-lucide="menu" class="w-5 h-5"></i>
                </button>
                <span id="currentProjectName" class="text-sm font-medium text-zinc-400">Untitled Project</span>
            </div>

            <div class="flex items-center gap-1 bg-surface rounded-lg p-1 border border-white/5">
                <button onclick="switchView('preview')" id="btnPreview" class="flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all bg-white/10 text-white shadow-sm">
                    <i data-lucide="eye" class="w-4 h-4"></i> Preview
                </button>
                <button onclick="switchView('code')" id="btnCode" class="flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium text-zinc-400 hover:text-white transition-all">
                    <i data-lucide="code-2" class="w-4 h-4"></i> Code
                </button>
            </div>

            <button onclick="downloadCode()" class="text-zinc-400 hover:text-primary transition-colors">
                <i data-lucide="download" class="w-5 h-5"></i>
            </button>
        </header>

        <div class="flex-1 p-4 lg:p-6 overflow-hidden relative flex flex-col items-center justify-center bg-[#050505]">
            
            <div class="w-full h-full max-w-6xl flex flex-col browser-mockup rounded-xl border border-white/10 overflow-hidden bg-[#1e1e1e] transition-all duration-500" id="workspaceContainer">
                
                <div class="h-10 bg-[#1e1e1e] border-b border-white/5 flex items-center px-4 gap-2 select-none">
                    <div class="flex gap-2">
                        <div class="w-3 h-3 rounded-full bg-[#ff5f56]"></div>
                        <div class="w-3 h-3 rounded-full bg-[#ffbd2e]"></div>
                        <div class="w-3 h-3 rounded-full bg-[#27c93f]"></div>
                    </div>
                    <div class="flex-1 flex justify-center">
                        <div class="bg-black/20 px-3 py-1 rounded text-[10px] text-zinc-500 font-mono flex items-center gap-1">
                            <i data-lucide="lock" class="w-3 h-3"></i> localhost:3000
                        </div>
                    </div>
                </div>

                <iframe id="previewFrame" class="w-full flex-1 bg-white" sandbox="allow-scripts allow-modals allow-forms"></iframe>

                <textarea id="codeEditor" class="w-full flex-1 p-4 code-editor resize-none focus:outline-none hidden" spellcheck="false"></textarea>

                <div id="emptyState" class="absolute inset-0 flex flex-col items-center justify-center bg-background/90 z-10 pointer-events-none">
                    <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center mb-4 border border-primary/20">
                        <i data-lucide="sparkles" class="w-8 h-8 text-primary"></i>
                    </div>
                    <h2 class="text-xl font-semibold text-white mb-2">What shall we build?</h2>
                    <p class="text-zinc-500 text-sm max-w-xs text-center">Describe the website you want, and I'll code it pixel-perfect.</p>
                </div>
            </div>
        </div>

        <div class="p-4 lg:p-6 relative z-20 w-full max-w-4xl mx-auto">
            <div class="relative group">
                <div class="absolute -inset-0.5 bg-gradient-to-r from-primary to-purple-600 rounded-xl opacity-30 group-focus-within:opacity-100 transition duration-500 blur"></div>
                
                <div class="relative flex items-end gap-2 bg-surface border border-white/10 rounded-xl p-2 shadow-2xl">
                    <textarea id="promptInput" rows="1" placeholder="Describe a website..." 
                        class="w-full bg-transparent text-white px-3 py-3 text-sm focus:outline-none resize-none max-h-32 placeholder-zinc-500"
                        oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'"></textarea>
                    
                    <button onclick="generateCode()" id="sendBtn" class="bg-white/10 hover:bg-white/20 text-white p-2.5 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed mb-0.5">
                        <i data-lucide="arrow-up" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
            
            <div id="loader" class="absolute -top-10 left-1/2 transform -translate-x-1/2 flex items-center gap-2 px-4 py-2 bg-zinc-800 rounded-full border border-white/5 opacity-0 transition-opacity pointer-events-none">
                <i data-lucide="terminal" class="w-4 h-4 text-primary"></i>
                <span class="text-xs text-zinc-300 font-mono">Generating Code</span>
                <div class="flex gap-1 ml-1">
                    <div class="w-1 h-1 bg-zinc-400 rounded-full typing-dot"></div>
                    <div class="w-1 h-1 bg-zinc-400 rounded-full typing-dot"></div>
                    <div class="w-1 h-1 bg-zinc-400 rounded-full typing-dot"></div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- INITIALIZATION ---
        lucide.createIcons();
        
        // State
        const STATE = {
            projects: JSON.parse(localStorage.getItem('bolt_projects')) || [],
            currentProjectId: null,
            apiKey: localStorage.getItem('bolt_api_key') || '',
            model: localStorage.getItem('bolt_model') || 'google/gemini-2.0-flash-lite-preview-02-05:free'
        };

        // DOM Elements
        const DOM = {
            input: document.getElementById('promptInput'),
            sendBtn: document.getElementById('sendBtn'),
            previewFrame: document.getElementById('previewFrame'),
            codeEditor: document.getElementById('codeEditor'),
            projectList: document.getElementById('projectList'),
            loader: document.getElementById('loader'),
            emptyState: document.getElementById('emptyState'),
            currentProjectName: document.getElementById('currentProjectName'),
            apiKeyInput: document.getElementById('apiKeyInput'),
            modelSelect: document.getElementById('modelSelect')
        };

        // System Prompt
        const SYSTEM_PROMPT = `You are an expert Frontend Engineer. Your task is to output ONLY the raw, complete, single-file HTML code for the requested website. 
        - Include all CSS inside <style> tags (use Tailwind CDN if possible, or vanilla CSS).
        - Include all JS inside <script> tags.
        - Ensure the design is modern, responsive, and production-ready.
        - Do not output markdown backticks.
        - Do not output explanations. 
        - Return ONLY the HTML string starting with <!DOCTYPE html> and ending with </html>.`;

        // --- LIFECYCLE ---
        
        window.onload = () => {
            DOM.apiKeyInput.value = STATE.apiKey;
            DOM.modelSelect.value = STATE.model;
            renderProjectList();
            
            if (STATE.projects.length > 0) {
                loadProject(STATE.projects[0].id); // Load most recent
            } else {
                createNewProject();
            }
        };

        // --- EVENT LISTENERS ---

        DOM.input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                generateCode();
            }
        });

        DOM.apiKeyInput.addEventListener('input', (e) => {
            STATE.apiKey = e.target.value;
            localStorage.setItem('bolt_api_key', STATE.apiKey);
        });

        DOM.modelSelect.addEventListener('change', (e) => {
            STATE.model = e.target.value;
            localStorage.setItem('bolt_model', STATE.model);
        });

        // --- CORE LOGIC ---

        function createNewProject() {
            const newProject = {
                id: Date.now(),
                name: `Project ${STATE.projects.length + 1}`,
                code: '',
                history: []
            };
            STATE.projects.unshift(newProject);
            saveProjects();
            loadProject(newProject.id);
            if(window.innerWidth < 1024) toggleSidebar();
        }

        function loadProject(id) {
            STATE.currentProjectId = id;
            const project = STATE.projects.find(p => p.id === id);
            if (!project) return;

            // UI Updates
            DOM.currentProjectName.innerText = project.name;
            renderProjectList();
            
            if (project.code) {
                updateWorkspace(project.code);
                DOM.emptyState.style.display = 'none';
            } else {
                DOM.previewFrame.srcdoc = '';
                DOM.codeEditor.value = '';
                DOM.emptyState.style.display = 'flex';
            }
        }

        function renderProjectList() {
            DOM.projectList.innerHTML = STATE.projects.map(p => `
                <div onclick="loadProject(${p.id})" 
                     class="group flex items-center justify-between p-2 rounded-lg cursor-pointer transition-colors ${STATE.currentProjectId === p.id ? 'bg-primary/20 text-white' : 'hover:bg-white/5 text-zinc-400 hover:text-zinc-200'}">
                    <span class="text-sm truncate max-w-[180px]">${p.name}</span>
                    <button onclick="deleteProject(event, ${p.id})" class="opacity-0 group-hover:opacity-100 hover:text-red-400 p-1">
                        <i data-lucide="trash-2" class="w-3 h-3"></i>
                    </button>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function deleteProject(e, id) {
            e.stopPropagation();
            if(!confirm('Delete this project?')) return;
            STATE.projects = STATE.projects.filter(p => p.id !== id);
            saveProjects();
            if (STATE.projects.length > 0) loadProject(STATE.projects[0].id);
            else createNewProject();
        }

        function saveProjects() {
            localStorage.setItem('bolt_projects', JSON.stringify(STATE.projects));
            renderProjectList();
        }

        // --- AI GENERATION ---

        async function generateCode() {
            const prompt = DOM.input.value.trim();
            if (!prompt) return;
            
            if (!STATE.apiKey) {
                alert("Please enter your OpenRouter/OpenAI API Key in the settings (bottom left).");
                return;
            }

            // UI States
            startLoading();
            const project = STATE.projects.find(p => p.id === STATE.currentProjectId);
            
            // Build Messages
            const messages = [
                { role: "system", content: SYSTEM_PROMPT },
                ...project.history,
                { role: "user", content: prompt }
            ];

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${STATE.apiKey}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        model: STATE.model,
                        messages: messages
                    })
                });

                if (!response.ok) throw new Error("API Request Failed");

                const data = await response.json();
                let content = data.choices[0].message.content;

                // Simple Extraction logic to remove markdown if present
                content = cleanCode(content);

                // Update State
                project.history.push({ role: "user", content: prompt });
                project.history.push({ role: "assistant", content: content });
                project.code = content;
                
                // Auto-rename project based on first prompt if it's new
                if (project.name.startsWith('Project') && project.history.length <= 2) {
                    project.name = prompt.slice(0, 20) + "...";
                }

                saveProjects();
                updateWorkspace(content);
                DOM.input.value = '';

            } catch (error) {
                console.error(error);
                alert("Error generating code. Check console or API key.");
            } finally {
                stopLoading();
            }
        }

        function cleanCode(content) {
            // Remove markdown code blocks if they exist
            const codeBlockRegex = /```html([\s\S]*?)```/i;
            const match = content.match(codeBlockRegex);
            if (match) {
                return match[1].trim();
            }
            // If raw code was returned but with random text before/after, try to find DOCTYPE
            const docTypeIndex = content.indexOf('<!DOCTYPE html>');
            if (docTypeIndex !== -1) {
                const endIndex = content.lastIndexOf('</html>');
                if (endIndex !== -1) {
                    return content.substring(docTypeIndex, endIndex + 7);
                }
            }
            return content;
        }

        // --- UI UTILS ---

        function updateWorkspace(html) {
            DOM.emptyState.style.display = 'none';
            DOM.previewFrame.srcdoc = html;
            DOM.codeEditor.value = html;
        }

        function switchView(view) {
            const btnPreview = document.getElementById('btnPreview');
            const btnCode = document.getElementById('btnCode');

            if (view === 'preview') {
                DOM.previewFrame.classList.remove('hidden');
                DOM.codeEditor.classList.add('hidden');
                btnPreview.className = "flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all bg-white/10 text-white shadow-sm";
                btnCode.className = "flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium text-zinc-400 hover:text-white transition-all";
            } else {
                DOM.previewFrame.classList.add('hidden');
                DOM.codeEditor.classList.remove('hidden');
                btnCode.className = "flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all bg-white/10 text-white shadow-sm";
                btnPreview.className = "flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium text-zinc-400 hover:text-white transition-all";
            }
        }

        function downloadCode() {
            const project = STATE.projects.find(p => p.id === STATE.currentProjectId);
            if (!project || !project.code) return;
            
            const blob = new Blob([project.code], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'website.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            
            if (sidebar.classList.contains('-translate-x-full')) {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
            } else {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            }
        }

        function startLoading() {
            DOM.loader.style.opacity = '1';
            DOM.sendBtn.disabled = true;
            DOM.sendBtn.innerHTML = '<div class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>';
        }

        function stopLoading() {
            DOM.loader.style.opacity = '0';
            DOM.sendBtn.disabled = false;
            DOM.sendBtn.innerHTML = '<i data-lucide="arrow-up" class="w-5 h-5"></i>';
            lucide.createIcons();
        }

    </script>
</body>
</html>
