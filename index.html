<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Homework Helper - Gemini 2.5 Flash</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeInDown 0.8s ease;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #a0aec0;
            font-size: 1.1em;
        }

        .api-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            animation: fadeIn 1s ease;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #cbd5e0;
            font-weight: 500;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: #ffffff;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.12);
        }

        input[type="text"]::placeholder {
            color: #718096;
        }

        .upload-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            animation: fadeIn 1.2s ease;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        button {
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-camera {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-gallery {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-solve {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            font-size: 1.2em;
            padding: 18px 40px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .preview-section {
            display: none;
            margin-bottom: 30px;
            animation: fadeIn 0.5s ease;
        }

        .preview-section.active {
            display: block;
        }

        .preview-image {
            width: 100%;
            max-height: 400px;
            object-fit: contain;
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
        }

        .scanning-animation {
            display: none;
            text-align: center;
            padding: 40px;
            animation: pulse 1.5s infinite;
        }

        .scanning-animation.active {
            display: block;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .result-section {
            display: none;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            animation: fadeIn 0.8s ease;
        }

        .result-section.active {
            display: block;
        }

        .result-content {
            color: #e2e8f0;
            line-height: 1.8;
            font-size: 1.05em;
        }

        .result-content h1, .result-content h2, .result-content h3 {
            color: #667eea;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .result-content code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }

        .result-content pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid rgba(239, 68, 68, 0.5);
            color: #fca5a5;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }

        .error-message.active {
            display: block;
            animation: shake 0.5s ease;
        }

        input[type="file"] {
            display: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéì AI Homework Helper</h1>
            <p class="subtitle">Powered by Gemini 2.5 Flash - The Fastest AI Vision Model</p>
        </header>

        <div class="api-section">
            <div class="input-group">
                <label for="apiKey">üîë Enter Your Gemini API Key:</label>
                <input 
                    type="text" 
                    id="apiKey" 
                    placeholder="AIza...your-api-key-here"
                    autocomplete="off"
                >
                <small style="color: #a0aec0; display: block; margin-top: 8px;">
                    Get your free API key at <a href="https://aistudio.google.com/apikey" target="_blank" style="color: #667eea;">Google AI Studio</a>
                </small>
            </div>
        </div>

        <div class="upload-section">
            <h2 style="margin-bottom: 20px; color: #cbd5e0;">üì§ Upload Your Homework</h2>
            <div class="button-group">
                <button class="btn-camera" onclick="openCamera()">
                    üì∏ Take Photo
                </button>
                <button class="btn-gallery" onclick="openGallery()">
                    üñºÔ∏è Choose from Gallery
                </button>
            </div>
            <input type="file" id="cameraInput" accept="image/*" capture="environment" onchange="handleImageUpload(event)">
            <input type="file" id="galleryInput" accept="image/*" onchange="handleImageUpload(event)">
        </div>

        <div class="preview-section" id="previewSection">
            <h3 style="margin-bottom: 15px; color: #cbd5e0;">üì∑ Image Preview:</h3>
            <img id="previewImage" class="preview-image" alt="Preview">
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn-solve" onclick="solveHomework()">
                    üöÄ Solve My Homework!
                </button>
            </div>
        </div>

        <div class="scanning-animation" id="scanningAnimation">
            <div class="spinner"></div>
            <h3>üîç Analyzing your homework...</h3>
            <p style="color: #a0aec0; margin-top: 10px;">Gemini 2.5 Flash is processing your image</p>
        </div>

        <div class="result-section" id="resultSection">
            <h2 style="margin-bottom: 20px; color: #667eea;">‚úÖ Solution:</h2>
            <div class="result-content" id="resultContent"></div>
        </div>

        <div class="error-message" id="errorMessage"></div>
    </div>

    <!-- Marked.js for Markdown Rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- KaTeX for LaTeX Rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <script>
        let imageBase64 = null;

        function openCamera() {
            document.getElementById('cameraInput').click();
        }

        function openGallery() {
            document.getElementById('galleryInput').click();
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (!file.type.startsWith('image/')) {
                showError('Please upload a valid image file!');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const base64String = e.target.result;
                imageBase64 = base64String.split(',')[1]; // Remove data:image/png;base64, prefix
                
                // Show preview
                document.getElementById('previewImage').src = base64String;
                document.getElementById('previewSection').classList.add('active');
                hideError();
            };
            reader.readAsDataURL(file);
        }

        async function solveHomework() {
            const apiKey = document.getElementById('apiKey').value.trim();

            if (!apiKey) {
                showError('‚ö†Ô∏è Please enter your Gemini API key!');
                return;
            }

            if (!imageBase64) {
                showError('‚ö†Ô∏è Please upload an image first!');
                return;
            }

            // Show loading animation
            document.getElementById('scanningAnimation').classList.add('active');
            document.getElementById('resultSection').classList.remove('active');
            hideError();

            try {
                // NEW GEMINI 2.5 FLASH API ENDPOINT
                const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;

                const requestBody = {
                    contents: [{
                        parts: [
                            {
                                text: `You are a genius tutor with expertise in all academic subjects. Analyze this homework problem and provide a comprehensive solution.

Instructions:
1. Identify the subject and problem type
2. Provide a clear, step-by-step solution
3. Explain each step in detail
4. Show all calculations and reasoning
5. Use proper mathematical notation with LaTeX for formulas
6. Highlight key concepts and learning points
7. If multiple approaches exist, mention them
8. End with a clear final answer

Format your response using:
- Markdown for structure (headers, lists, bold, italic)
- LaTeX notation for math (use $...$ for inline math and $$...$$ for display math)
- Clear section headers
- Numbered steps for solutions

Be educational, encouraging, and thorough. Help the student understand the concept, not just get the answer.`
                            },
                            {
                                inline_data: {
                                    mime_type: "image/jpeg",
                                    data: imageBase64
                                }
                            }
                        ]
                    }],
                    generationConfig: {
                        temperature: 0.4,
                        topK: 32,
                        topP: 1,
                        maxOutputTokens: 8192
                    }
                };

                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `API Error: ${response.status}`);
                }

                const data = await response.json();
                
                if (!data.candidates || !data.candidates[0]?.content?.parts?.[0]?.text) {
                    throw new Error('Invalid response format from API');
                }

                const solution = data.candidates[0].content.parts[0].text;
                displayResult(solution);

            } catch (error) {
                console.error('Error:', error);
                showError(`‚ùå Error: ${error.message}`);
            } finally {
                document.getElementById('scanningAnimation').classList.remove('active');
            }
        }

        function displayResult(markdown) {
            // Convert Markdown to HTML
            let html = marked.parse(markdown);
            
            // Display result
            const resultContent = document.getElementById('resultContent');
            resultContent.innerHTML = html;
            document.getElementById('resultSection').classList.add('active');

            // Render LaTeX math
            renderMathInElement(resultContent, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false},
                    {left: '\\[', right: '\\]', display: true},
                    {left: '\\(', right: '\\)', display: false}
                ],
                throwOnError: false
            });

            // Scroll to result
            document.getElementById('resultSection').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('active');
        }

        function hideError() {
            document.getElementById('errorMessage').classList.remove('active');
        }

        // Load API key from localStorage
        window.addEventListener('DOMContentLoaded', () => {
            const savedApiKey = localStorage.getItem('gemini_api_key');
            if (savedApiKey) {
                document.getElementById('apiKey').value = savedApiKey;
            }

            // Save API key on input
            document.getElementById('apiKey').addEventListener('input', (e) => {
                localStorage.setItem('gemini_api_key', e.target.value);
            });
        });
    </script>
</body>
</html>
