<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Web Builder | Bolt Clone</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cyber: {
                            bg: '#0a0a0a',
                            accent: '#00f3ff',
                            dark: '#111111',
                            glass: 'rgba(255, 255, 255, 0.05)',
                            border: 'rgba(255, 255, 255, 0.1)'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    boxShadow: {
                        'neon': '0 0 10px rgba(0, 243, 255, 0.3), 0 0 20px rgba(0, 243, 255, 0.1)',
                        'neon-hover': '0 0 15px rgba(0, 243, 255, 0.5), 0 0 30px rgba(0, 243, 255, 0.2)'
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #0a0a0a;
            color: #e5e5e5;
            overflow: hidden; /* App-like feel */
        }

        /* Glassmorphism Utilities */
        .glass-panel {
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .glass-sidebar {
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(15px);
            border-right: 1px solid rgba(255, 255, 255, 0.08);
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #0a0a0a;
        }
        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #00f3ff;
        }

        /* Loader Animation */
        .loader {
            border: 3px solid rgba(0, 243, 255, 0.1);
            border-left-color: #00f3ff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Syntax Highlighting overrides */
        pre { margin: 0; height: 100%; border-radius: 0; }
        code { font-family: 'JetBrains Mono', monospace !important; font-size: 0.85rem; }
    </style>
</head>
<body class="flex h-screen w-screen text-sm font-sans selection:bg-cyber-accent selection:text-black">

    <aside class="w-64 glass-sidebar flex flex-col h-full absolute md:relative z-20 transition-transform duration-300 transform -translate-x-full md:translate-x-0" id="sidebar">
        <div class="p-4 border-b border-cyber-border flex items-center justify-between">
            <h1 class="font-bold text-lg tracking-wider text-white"><i class="fa-solid fa-bolt text-cyber-accent mr-2"></i>BUILDER.AI</h1>
        </div>
        
        <div class="flex-1 overflow-y-auto p-3 space-y-2" id="history-list">
            <div class="text-xs text-gray-500 text-center mt-4">No projects yet.</div>
        </div>

        <div class="p-4 border-t border-cyber-border">
            <button onclick="openSettings()" class="w-full flex items-center justify-center gap-2 py-2 px-4 rounded bg-white/5 hover:bg-white/10 transition text-gray-300 hover:text-white">
                <i class="fa-solid fa-gear"></i> Settings
            </button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col h-full relative bg-gradient-to-br from-cyber-bg to-[#111]">
        
        <header class="h-14 glass-panel border-b-0 border-l border-r-0 border-t-0 flex items-center justify-between px-4 z-10 shrink-0">
            <div class="flex items-center gap-3">
                <button class="md:hidden text-gray-400 hover:text-white" onclick="toggleSidebar()">
                    <i class="fa-solid fa-bars"></i>
                </button>
                <div class="flex gap-1.5 opacity-70">
                    <div class="w-3 h-3 rounded-full bg-red-500"></div>
                    <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                    <div class="w-3 h-3 rounded-full bg-green-500"></div>
                </div>
            </div>

            <div class="flex bg-black/40 rounded-lg p-1 border border-cyber-border">
                <button id="btn-preview" onclick="switchView('preview')" class="px-3 py-1.5 rounded-md text-xs font-medium bg-cyber-accent text-black shadow-neon transition-all">
                    <i class="fa-solid fa-eye mr-1"></i> Preview
                </button>
                <button id="btn-code" onclick="switchView('code')" class="px-3 py-1.5 rounded-md text-xs font-medium text-gray-400 hover:text-white transition-all">
                    <i class="fa-solid fa-code mr-1"></i> Code
                </button>
            </div>

            <button onclick="downloadCode()" class="text-gray-400 hover:text-cyber-accent transition" title="Download HTML">
                <i class="fa-solid fa-download"></i>
            </button>
        </header>

        <div class="flex-1 relative overflow-hidden bg-black/20">
            
            <div id="view-preview" class="w-full h-full absolute inset-0 bg-white">
                <iframe id="preview-frame" class="w-full h-full border-none" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
                <div id="empty-state" class="absolute inset-0 bg-cyber-bg flex flex-col items-center justify-center text-gray-500 z-10">
                    <i class="fa-solid fa-laptop-code text-6xl mb-4 text-cyber-glass opacity-20"></i>
                    <p>Enter a prompt to generate your app.</p>
                </div>
            </div>

            <div id="view-code" class="w-full h-full absolute inset-0 hidden bg-[#282c34] overflow-auto">
                <pre><code id="code-display" class="language-html"></code></pre>
            </div>
            
            <div id="loader-overlay" class="absolute inset-0 bg-black/80 backdrop-blur-sm z-50 flex flex-col items-center justify-center hidden">
                <div class="loader mb-4"></div>
                <p class="text-cyber-accent animate-pulse font-mono">Generating Architecture...</p>
            </div>
        </div>

        <div class="absolute bottom-6 left-0 right-0 px-4 md:px-12 flex justify-center z-30">
            <div class="w-full max-w-3xl glass-panel rounded-xl p-2 pl-4 pr-2 flex items-center shadow-neon transition-shadow focus-within:shadow-neon-hover">
                <input type="text" id="user-input" 
                    class="flex-1 bg-transparent border-none outline-none text-white placeholder-gray-500 font-sans h-10"
                    placeholder="Describe your website (e.g., 'A neon-themed gym landing page')..."
                    autocomplete="off">
                <button onclick="generateSite()" class="bg-cyber-accent/10 hover:bg-cyber-accent text-cyber-accent hover:text-black border border-cyber-accent/50 rounded-lg w-10 h-10 flex items-center justify-center transition-all duration-300">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </div>
        </div>

    </main>

    <div id="settings-modal" class="fixed inset-0 z-50 hidden bg-black/80 backdrop-blur-sm flex items-center justify-center">
        <div class="glass-panel w-full max-w-md rounded-xl p-6 shadow-2xl border border-cyber-accent/20">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-white"><i class="fa-solid fa-sliders mr-2 text-cyber-accent"></i> Configuration</h2>
                <button onclick="closeSettings()" class="text-gray-400 hover:text-white"><i class="fa-solid fa-times"></i></button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-xs uppercase tracking-wider text-gray-500 mb-1">OpenRouter API Key</label>
                    <input type="password" id="api-key-input" class="w-full bg-black/40 border border-cyber-border rounded p-2 text-white focus:border-cyber-accent focus:outline-none transition" placeholder="sk-or-...">
                    <p class="text-[10px] text-gray-500 mt-1">Key is stored locally in your browser.</p>
                </div>
                <div>
                    <label class="block text-xs uppercase tracking-wider text-gray-500 mb-1">Model ID</label>
                    <input type="text" id="model-input" value="deepseek/deepseek-r1:free" class="w-full bg-black/40 border border-cyber-border rounded p-2 text-white focus:border-cyber-accent focus:outline-none transition">
                </div>
            </div>

            <div class="mt-6 flex justify-end">
                <button onclick="saveSettings()" class="bg-cyber-accent text-black font-bold py-2 px-6 rounded hover:bg-white transition shadow-neon">Save Configuration</button>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        //  THE HIDDEN BRAIN (System Prompt)
        // ==========================================
        const SYSTEM_PROMPT = "You are an elite Frontend Architect. Your job is to generate production-ready, single-file HTML applications.\nRULES:\n1. Output ONLY the raw HTML code (containing CSS in <style> and JS in <script>).\n2. Do NOT use Markdown backticks (```html). Do NOT write explanations or conversational filler.\n3. If the user gives a short instruction (e.g., 'gym website'), YOU MUST INFER a premium, modern design with images (use unsplash source URLs), responsive layout, and interactive elements.\n4. Use Tailwind CSS via CDN for styling.\n5. If editing an existing code, return the FULL updated code, not just the diff.";

        // ==========================================
        //  STATE MANAGEMENT
        // ==========================================
        let currentCode = "";
        let projects = JSON.parse(localStorage.getItem('bolt_projects')) || [];
        
        // DOM Elements
        const inputField = document.getElementById('user-input');
        const previewFrame = document.getElementById('preview-frame');
        const codeDisplay = document.getElementById('code-display');
        const loader = document.getElementById('loader-overlay');
        const emptyState = document.getElementById('empty-state');
        const historyList = document.getElementById('history-list');

        // Initial Load
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            renderHistory();
            
            // Check for API key
            if(!localStorage.getItem('bolt_api_key')) {
                openSettings();
            }

            // Input Enter Key
            inputField.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') generateSite();
            });
        });

        // ==========================================
        //  CORE LOGIC: GENERATION
        // ==========================================
        async function generateSite() {
            const prompt = inputField.value.trim();
            const apiKey = localStorage.getItem('bolt_api_key');
            const model = localStorage.getItem('bolt_model') || 'deepseek/deepseek-r1:free';

            if (!prompt) return;
            if (!apiKey) {
                alert("Please enter your OpenRouter API Key in settings.");
                openSettings();
                return;
            }

            // UI Updates
            loader.classList.remove('hidden');
            emptyState.classList.add('hidden');
            
            // Context Management (Include current code if iterating)
            let messages = [
                { role: "system", content: SYSTEM_PROMPT }
            ];

            if (currentCode) {
                messages.push({ 
                    role: "user", 
                    content: `Here is the current code:\n${currentCode}\n\nUpdate instructions: ${prompt}` 
                });
            } else {
                messages.push({ role: "user", content: prompt });
            }

            try {
                const response = await fetch("[https://openrouter.ai/api/v1/chat/completions](https://openrouter.ai/api/v1/chat/completions)", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${apiKey}`,
                        "Content-Type": "application/json",
                        "HTTP-Referer": window.location.href, // OpenRouter requirement
                        "X-Title": "AI Web Builder"
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: messages,
                        temperature: 0.7 // Creativity balanced with code structure
                    })
                });

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error.message);
                }

                let rawContent = data.choices[0].message.content;

                // CLEANER: Strip Markdown if the AI disobeyed
                const cleanHtml = rawContent
                    .replace(/```html/g, '')
                    .replace(/```/g, '')
                    .trim();

                // Update State
                currentCode = cleanHtml;
                
                // Update UI
                updatePreview(currentCode);
                updateCodeView(currentCode);
                addToHistory(prompt, currentCode);
                
                inputField.value = ''; // Clear input

            } catch (error) {
                console.error(error);
                alert("Generation Failed: " + error.message);
                emptyState.classList.remove('hidden');
            } finally {
                loader.classList.add('hidden');
            }
        }

        function updatePreview(html) {
            // We use blob to avoid some cross-origin issues and handle special chars better
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            previewFrame.src = url;
        }

        function updateCodeView(html) {
            codeDisplay.textContent = html;
            hljs.highlightElement(codeDisplay);
        }

        // ==========================================
        //  UI HELPERS
        // ==========================================
        function switchView(view) {
            const btnPreview = document.getElementById('btn-preview');
            const btnCode = document.getElementById('btn-code');
            const viewPreview = document.getElementById('view-preview');
            const viewCode = document.getElementById('view-code');

            if (view === 'preview') {
                viewPreview.classList.remove('hidden');
                viewCode.classList.add('hidden');
                
                // Style Buttons
                btnPreview.className = "px-3 py-1.5 rounded-md text-xs font-medium bg-cyber-accent text-black shadow-neon transition-all";
                btnCode.className = "px-3 py-1.5 rounded-md text-xs font-medium text-gray-400 hover:text-white transition-all";
            } else {
                viewPreview.classList.add('hidden');
                viewCode.classList.remove('hidden');
                
                // Style Buttons
                btnPreview.className = "px-3 py-1.5 rounded-md text-xs font-medium text-gray-400 hover:text-white transition-all";
                btnCode.className = "px-3 py-1.5 rounded-md text-xs font-medium bg-cyber-accent text-black shadow-neon transition-all";
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('-translate-x-full');
        }

        function downloadCode() {
            if (!currentCode) return;
            const blob = new Blob([currentCode], {type: "text/html"});
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "website.html";
            link.click();
        }

        // ==========================================
        //  HISTORY & STORAGE
        // ==========================================
        function addToHistory(prompt, code) {
            const project = {
                id: Date.now(),
                name: prompt.substring(0, 20) + (prompt.length > 20 ? '...' : ''),
                code: code,
                timestamp: new Date().toLocaleTimeString()
            };
            
            projects.unshift(project);
            if(projects.length > 10) projects.pop(); // Keep last 10
            
            localStorage.setItem('bolt_projects', JSON.stringify(projects));
            renderHistory();
        }

        function renderHistory() {
            historyList.innerHTML = '';
            if (projects.length === 0) {
                historyList.innerHTML = '<div class="text-xs text-gray-500 text-center mt-4">No projects yet.</div>';
                return;
            }

            projects.forEach(p => {
                const div = document.createElement('div');
                div.className = "p-3 rounded bg-white/5 hover:bg-white/10 cursor-pointer border border-transparent hover:border-cyber-accent/30 transition group";
                div.onclick = () => loadProject(p.id);
                div.innerHTML = `
                    <div class="text-xs font-bold text-gray-300 group-hover:text-cyber-accent truncate">${p.name}</div>
                    <div class="text-[10px] text-gray-600">${p.timestamp}</div>
                `;
                historyList.appendChild(div);
            });
        }

        function loadProject(id) {
            const project = projects.find(p => p.id === id);
            if (project) {
                currentCode = project.code;
                updatePreview(currentCode);
                updateCodeView(currentCode);
                emptyState.classList.add('hidden');
                // Auto switch to preview
                switchView('preview');
                // On mobile, close sidebar
                if(window.innerWidth < 768) toggleSidebar();
            }
        }

        // ==========================================
        //  SETTINGS
        // ==========================================
        function openSettings() {
            document.getElementById('settings-modal').classList.remove('hidden');
            loadSettings();
        }

        function closeSettings() {
            document.getElementById('settings-modal').classList.add('hidden');
        }

        function saveSettings() {
            const key = document.getElementById('api-key-input').value.trim();
            const model = document.getElementById('model-input').value.trim();
            
            if(key) localStorage.setItem('bolt_api_key', key);
            if(model) localStorage.setItem('bolt_model', model);
            
            closeSettings();
        }

        function loadSettings() {
            document.getElementById('api-key-input').value = localStorage.getItem('bolt_api_key') || '';
            document.getElementById('model-input').value = localStorage.getItem('bolt_model') || 'deepseek/deepseek-r1:free';
        }

    </script>
</body>
</html>
