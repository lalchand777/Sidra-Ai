<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Website Builder</title>

  <!-- Inter Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            bg: "#1e1e1e",
            sidebar: "#252526",
            primary: "#3b82f6"
          },
          fontFamily: {
            inter: ["Inter", "system-ui", "sans-serif"]
          }
        }
      }
    }
  </script>

  <style>
    html, body { height: 100%; }
  </style>
</head>
<body class="bg-bg text-white font-inter overflow-hidden">

<div class="flex h-full">
  <!-- Sidebar -->
  <aside class="w-64 bg-sidebar border-r border-white/10 flex flex-col">
    <div class="p-4 flex justify-between items-center border-b border-white/10">
      <h2 class="font-semibold">Projects</h2>
      <button id="newProjectBtn" class="text-sm text-primary">+ New</button>
    </div>
    <ul id="projectList" class="flex-1 overflow-y-auto p-2 space-y-1"></ul>
    <button id="openSettings" class="m-3 px-3 py-2 rounded bg-white/5 hover:bg-white/10 text-sm">
      Settings
    </button>
  </aside>

  <!-- Main -->
  <main class="flex-1 flex flex-col relative">
    <!-- Top Bar -->
    <div class="flex items-center justify-between px-4 py-2 border-b border-white/10 bg-bg">
      <div class="flex space-x-2">
        <span class="w-3 h-3 rounded-full bg-red-500"></span>
        <span class="w-3 h-3 rounded-full bg-yellow-400"></span>
        <span class="w-3 h-3 rounded-full bg-green-500"></span>
      </div>
      <div class="flex space-x-2">
        <button id="previewBtn" class="px-3 py-1 text-sm bg-primary rounded">Preview</button>
        <button id="codeBtn" class="px-3 py-1 text-sm bg-white/10 rounded">Code</button>
        <button id="downloadBtn" class="px-3 py-1 text-sm bg-white/10 rounded">Download</button>
      </div>
    </div>

    <!-- Content -->
    <div class="flex-1 relative">
      <iframe id="previewFrame" class="absolute inset-0 w-full h-full bg-white"></iframe>
      <textarea id="codeView" class="absolute inset-0 w-full h-full bg-bg text-sm p-4 hidden"></textarea>
    </div>
  </main>
</div>

<!-- Fixed Input Bar -->
<div class="fixed bottom-0 left-0 w-full bg-bg border-t border-white/10 p-3 flex space-x-2">
  <textarea id="userInput" rows="2" placeholder="Describe the website you want to build..."
    class="flex-1 resize-none rounded bg-white/5 p-2 text-sm focus:outline-none"></textarea>
  <button id="sendBtn" class="px-4 py-2 bg-primary rounded text-sm">Send</button>
</div>

<!-- Settings Modal -->
<div id="settingsModal" class="fixed inset-0 bg-black/60 hidden items-center justify-center">
  <div class="bg-sidebar w-96 rounded p-5 space-y-4">
    <h3 class="font-semibold text-lg">Settings</h3>
    <div>
      <label class="text-sm block mb-1">OpenRouter API Key</label>
      <input id="apiKeyInput" type="password" class="w-full p-2 rounded bg-bg border border-white/10">
    </div>
    <div>
      <label class="text-sm block mb-1">Model ID</label>
      <input id="modelInput" type="text" class="w-full p-2 rounded bg-bg border border-white/10">
    </div>
    <div class="flex justify-end space-x-2">
      <button id="closeSettings" class="px-3 py-1 bg-white/10 rounded">Cancel</button>
      <button id="saveSettings" class="px-3 py-1 bg-primary rounded">Save</button>
    </div>
  </div>
</div>

<script>
/* =======================
   HIDDEN BRAIN
======================= */
const SYSTEM_PROMPT =
"You are an expert web developer. Output ONLY raw, single-file HTML/CSS/JS code. Do not use Markdown backticks. Do not explain. Ensure the code is responsive and modern using Tailwind CSS.";

/* =======================
   State & Storage
======================= */
let projects = JSON.parse(localStorage.getItem("projects") || "[]");
let currentProjectIndex = null;

const apiKeyStored = localStorage.getItem("apiKey") || "";
const modelStored = localStorage.getItem("modelId") || "deepseek/deepseek-r1:free";

/* =======================
   Elements
======================= */
const projectList = document.getElementById("projectList");
const previewFrame = document.getElementById("previewFrame");
const codeView = document.getElementById("codeView");
const userInput = document.getElementById("userInput");

/* =======================
   Init
======================= */
document.getElementById("apiKeyInput").value = apiKeyStored;
document.getElementById("modelInput").value = modelStored;

renderProjects();

/* =======================
   Functions
======================= */
function renderProjects() {
  projectList.innerHTML = "";
  projects.forEach((p, i) => {
    const li = document.createElement("li");
    li.textContent = p.name || "Untitled";
    li.className = "p-2 rounded cursor-pointer hover:bg-white/10 text-sm";
    li.onclick = () => loadProject(i);
    projectList.appendChild(li);
  });
}

function loadProject(index) {
  currentProjectIndex = index;
  const code = projects[index].code;
  updateView(code);
}

function updateView(code) {
  codeView.value = code;
  previewFrame.srcdoc = code;
}

function saveCurrent(code) {
  if (currentProjectIndex === null) {
    projects.unshift({ name: "Project " + (projects.length + 1), code });
    currentProjectIndex = 0;
  } else {
    projects[currentProjectIndex].code = code;
  }
  localStorage.setItem("projects", JSON.stringify(projects));
  renderProjects();
}

/* =======================
   API Call
======================= */
async function generateSite(prompt) {
  const apiKey = localStorage.getItem("apiKey");
  const model = localStorage.getItem("modelId");
  if (!apiKey) {
    alert("Please set your OpenRouter API Key in Settings.");
    return;
  }

  const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
    method: "POST",
    headers: {
      "Authorization": "Bearer " + apiKey,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      model,
      messages: [
        { role: "system", content: SYSTEM_PROMPT },
        { role: "user", content: prompt }
      ]
    })
  });

  if (!res.ok) {
    alert("API Error. Check your key or model.");
    return;
  }

  const data = await res.json();
  const code = data.choices[0].message.content;
  saveCurrent(code);
  updateView(code);
}

/* =======================
   Events
======================= */
document.getElementById("sendBtn").onclick = () => {
  const prompt = userInput.value.trim();
  if (!prompt) return;
  userInput.value = "";
  generateSite(prompt);
};

document.getElementById("previewBtn").onclick = () => {
  previewFrame.classList.remove("hidden");
  codeView.classList.add("hidden");
};

document.getElementById("codeBtn").onclick = () => {
  codeView.classList.remove("hidden");
  previewFrame.classList.add("hidden");
};

document.getElementById("downloadBtn").onclick = () => {
  const blob = new Blob([codeView.value], { type: "text/html" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "index.html";
  a.click();
};

document.getElementById("newProjectBtn").onclick = () => {
  currentProjectIndex = null;
  updateView("");
};

document.getElementById("openSettings").onclick = () => {
  document.getElementById("settingsModal").classList.remove("hidden");
  document.getElementById("settingsModal").classList.add("flex");
};

document.getElementById("closeSettings").onclick = () => {
  document.getElementById("settingsModal").classList.add("hidden");
};

document.getElementById("saveSettings").onclick = () => {
  localStorage.setItem("apiKey", document.getElementById("apiKeyInput").value);
  localStorage.setItem("modelId", document.getElementById("modelInput").value);
  document.getElementById("settingsModal").classList.add("hidden");
};
</script>

</body>
</html>
